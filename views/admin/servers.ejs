<%- include('../partials/header') %>

<section class="admin-header">
  <div class="container">
    <h1 class="page-title"><i data-lucide="settings"></i> <span data-i18n="admin_server_mgmt">Управление серверами</span></h1>
    <nav class="admin-nav">
      <a href="/admin" class="admin-tab" data-i18n="admin_tab_home">Главная</a>
      <a href="/admin/news" class="admin-tab" data-i18n="admin_tab_news">Новости</a>
      <a href="/admin/servers" class="admin-tab active" data-i18n="admin_tab_servers">Сервера</a>
      <a href="/admin/users" class="admin-tab" data-i18n="admin_tab_users">Пользователи</a>
      <a href="/admin/settings" class="admin-tab" data-i18n="admin_tab_settings">Настройки</a>
      <a href="/admin/proxmox" class="admin-tab">Proxmox</a>
    </nav>
  </div>
</section>

<section class="section container">
  <% if (servers.length === 0) { %>
    <div class="empty-state">
      <p><span data-i18n="admin_no_servers">Сервера не настроены.</span> <button type="button" class="btn btn-primary btn-sm" onclick="window.location='/admin/servers/new'" data-i18n="add">Добавить</button>.</p>
    </div>
  <% } else { %>
    <div class="admin-table-wrapper">
      <div class="admin-section-header">
        <h2 data-i18n="admin_all_servers">Все сервера</h2>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <form action="/admin/servers/refresh" method="POST" style="display:inline;">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit" class="btn btn-sm btn-outline"><i data-lucide="refresh-cw"></i> <span data-i18n="admin_refresh_status">Обновить статус</span></button>
          </form>
          <button type="button" class="btn btn-primary btn-sm" onclick="window.location='/admin/servers/new'">+ <span data-i18n="admin_add_server">Добавить сервер</span></button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="data-table table-servers">
          <thead>
            <tr>
              <th data-i18n="admin_th_name">Название</th>
              <th data-i18n="admin_th_game">Игра</th>
              <th data-i18n="admin_th_address">Адрес</th>
              <th data-i18n="admin_th_status">Статус</th>
              <th data-i18n="admin_th_redirect">Редирект</th>
              <th data-i18n="admin_th_actions">Действия</th>
            </tr>
          </thead>
          <tbody>
            <% servers.forEach(function(srv) { %>
              <tr>
                <td><strong><%= srv.name %></strong></td>
                <td><%= srv.game %></td>
                <td class="mono"><%= srv.ip %>:<%= srv.port %></td>
                <td>
                  <span class="status-badge badge-<%= srv.status %>">
                    <%= srv.status === 'online' ? 'Online' : 'Offline' %>
                  </span>
                </td>
                <td>
                  <% if (srv.redirect_enabled) { %>
                    <span class="tag tag-active" data-i18n="admin_redirect_on">Вкл</span>
                  <% } else { %>
                    <span class="tag tag-inactive" data-i18n="admin_redirect_off">Выкл</span>
                  <% } %>
                </td>
                <td class="actions-cell">
                  <a href="/admin/servers/<%= srv.id %>/edit" class="btn btn-xs btn-outline" data-i18n="admin_edit_short">Ред.</a>
                  <form action="/admin/servers/<%= srv.id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm(window.i18n ? window.i18n.t('admin_confirm_delete_server') : 'Удалить этот сервер?')">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn btn-xs btn-danger" data-i18n="delete">Удалить</button>
                  </form>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  <% } %>
</section>

<%- include('../partials/footer') %>
