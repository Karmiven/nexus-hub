<%- include('../partials/header') %>

<style>
  .admin-table-wrapper {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    overflow: hidden;
    margin-bottom: 2rem;
  }

  .admin-table-wrapper .admin-section-header {
    background: var(--bg-card);
    border-bottom: 1px solid var(--border);
    padding: 1.5rem;
    margin-bottom: 0;
  }

  .admin-table-wrapper .data-table {
    background: var(--bg-surface);
    border: none;
    border-radius: 0;
    overflow: visible;
  }

  .admin-table-wrapper .data-table thead {
    background: var(--bg-card);
  }

  .admin-table-wrapper .data-table th {
    padding: 1rem;
    border-bottom: 1px solid var(--border);
  }

  .admin-table-wrapper .data-table td {
    padding: 0.75rem 1rem;
    box-sizing: border-box;
  }

  .admin-table-wrapper .data-table tbody tr {
    box-shadow: inset 0 -1px 0 0 var(--border);
  }

  .admin-table-wrapper .data-table tbody tr:last-child {
    box-shadow: none;
  }

  .admin-table-wrapper .data-table tbody tr:hover {
    background: rgba(6, 182, 212, 0.05);
  }


</style>

<section class="admin-header">
  <div class="container">
    <h1 class="page-title">&#9881; Управление серверами</h1>
    <nav class="admin-nav">
      <a href="/admin" class="admin-tab">Главная</a>
      <a href="/admin/news" class="admin-tab">Новости</a>
      <a href="/admin/servers" class="admin-tab active">Сервера</a>
      <a href="/admin/users" class="admin-tab">Пользователи</a>
      <a href="/admin/settings" class="admin-tab">Настройки</a>
    </nav>
  </div>
</section>

<section class="section container">
  <% if (servers.length === 0) { %>
    <div class="empty-state">
      <p>Сервера не настроены. <button type="button" class="btn btn-primary btn-sm" onclick="window.location='/admin/servers/new'">Добавить</button>.</p>
    </div>
  <% } else { %>
    <div class="admin-table-wrapper">
      <div class="admin-section-header">
        <h2>Все сервера</h2>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <form action="/admin/servers/refresh" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-outline">&#128260; Обновить статус</button>
          </form>
          <button type="button" class="btn btn-primary btn-sm" onclick="window.location='/admin/servers/new'">+ Добавить сервер</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Название</th>
              <th>Игра</th>
              <th>Адрес</th>
              <th>Статус</th>
              <th>Редирект</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody>
            <% servers.forEach(function(srv) { %>
              <tr>
                <td><strong><%= srv.name %></strong></td>
                <td><%= srv.game %></td>
                <td class="mono"><%= srv.ip %>:<%= srv.port %></td>
                <td>
                  <span class="status-badge badge-<%= srv.status %>">
                    <%= srv.status === 'online' ? 'Online' : 'Offline' %>
                  </span>
                </td>
                <td>
                  <% if (srv.redirect_enabled) { %>
                    <span class="tag tag-active">Вкл</span>
                  <% } else { %>
                    <span class="tag tag-inactive">Выкл</span>
                  <% } %>
                </td>
                <td class="actions-cell">
                  <a href="/admin/servers/<%= srv.id %>/edit" class="btn btn-xs btn-outline">Ред.</a>
                  <form action="/admin/servers/<%= srv.id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Удалить этот сервер?')">
                    <button type="submit" class="btn btn-xs btn-danger">Удалить</button>
                  </form>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  <% } %>
</section>

<%- include('../partials/footer') %>
